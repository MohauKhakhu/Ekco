<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Management App</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [users, setUsers] = useState([]);
      const [newUser, setNewUser] = useState({
        name: '', dob: '', occupation: '', gender: '', date_added: ''
      });
      const [editingUser, setEditingUser] = useState(null);
      const [message, setMessage] = useState('');

      const apiUrl = 'http://localhost:3000/api/users';

      // Hardcoded login validation
      const handleLogin = (e) => {
        e.preventDefault();
        if (username === 'admin' && password === 'password123') {
          setIsAuthenticated(true);
          setMessage('Login successful!');
        } else {
          setMessage('Invalid username or password');
        }
      };

      // Fetch users from API
      useEffect(() => {
        if (isAuthenticated) {
          fetch(apiUrl)
            .then(res => res.json())
            .then(data => setUsers(data))
            .catch(err => setMessage('Error fetching users: ' + err.message));
        }
      }, [isAuthenticated]);

      // Handle input changes for new user
      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setNewUser(prev => ({ ...prev, [name]: value }));
      };

      // Create new user
      const handleCreate = (e) => {
        e.preventDefault();
        if (!newUser.name || !newUser.dob || !newUser.occupation || !newUser.gender || !newUser.date_added) {
          setMessage('All fields are required');
          return;
        }
        fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newUser)
        })
          .then(res => res.json())
          .then(data => {
            setUsers([...users, data]);
            setNewUser({ name: '', dob: '', occupation: '', gender: '', date_added: '' });
            setMessage('User created successfully');
          })
          .catch(err => setMessage('Error creating user: ' + err.message));
      };

      // Edit user
      const handleEdit = (user) => {
        setEditingUser(user);
        setNewUser(user);
      };

      // Update user
      const handleUpdate = (e) => {
        e.preventDefault();
        if (!newUser.name || !newUser.dob || !newUser.occupation || !newUser.gender || !newUser.date_added) {
          setMessage('All fields are required');
          return;
        }
        fetch(`${apiUrl}/${editingUser.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newUser)
        })
          .then(res => res.json())
          .then(data => {
            setUsers(users.map(u => u.id === data.id ? data : u));
            setEditingUser(null);
            setNewUser({ name: '', dob: '', occupation: '', gender: '', date_added: '' });
            setMessage('User updated successfully');
          })
          .catch(err => setMessage('Error updating user: ' + err.message));
      };

      // Delete user
      const handleDelete = (id) => {
        fetch(`${apiUrl}/${id}`, {
          method: 'DELETE'
        })
          .then(() => {
            setUsers(users.filter(u => u.id !== id));
            setMessage('User deleted successfully');
          })
          .catch(err => setMessage('Error deleting user: ' + err.message));
      };

      if (!isAuthenticated) {
        return (
          <div className="flex items-center justify-center min-h-screen bg-gray-100">
            <div className="bg-white p-8 rounded shadow-md w-full max-w-md">
              <h2 className="text-2xl font-bold mb-6 text-center">Login</h2>
              <form onSubmit={handleLogin}>
                <div className="mb-4">
                  <label className="block text-gray-700">Username</label>
                  <input
                    type="text"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    className="w-full p-2 border rounded"
                  />
                </div>
                <div className="mb-4">
                  <label className="block text-gray-700">Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full p-2 border rounded"
                  />
                </div>
                <button type="submit" className="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                  Login
                </button>
              </form>
              {message && <p className="mt-4 text-center text-red-500">{message}</p>}
            </div>
          </div>
        );
      }

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-3xl font-bold mb-6">User Management</h1>
          {message && <p className="mb-4 text-center text-green-500">{message}</p>}
          
          {/* Create/Edit Form */}
          <form onSubmit={editingUser ? handleUpdate : handleCreate} className="mb-8">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input
                type="text"
                name="name"
                value={newUser.name}
                onChange={handleInputChange}
                placeholder="Name"
                className="p-2 border rounded"
              />
              <input
                type="date"
                name="dob"
                value={newUser.dob}
                onChange={handleInputChange}
                className="p-2 border rounded"
              />
              <input
                type="text"
                name="occupation"
                value={newUser.occupation}
                onChange={handleInputChange}
                placeholder="Occupation"
                className="p-2 border rounded"
              />
              <select
                name="gender"
                value={newUser.gender}
                onChange={handleInputChange}
                className="p-2 border rounded"
              >
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
              <input
                type="date"
                name="date_added"
                value={newUser.date_added}
                onChange={handleInputChange}
                className="p-2 border rounded"
              />
            </div>
            <button
              type="submit"
              className="mt-4 bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
            >
              {editingUser ? 'Update User' : 'Add User'}
            </button>
            {editingUser && (
              <button
                type="button"
                onClick={() => {
                  setEditingUser(null);
                  setNewUser({ name: '', dob: '', occupation: '', gender: '', date_added: '' });
                }}
                className="mt-4 ml-4 bg-gray-500 text-white p-2 rounded hover:bg-gray-600"
              >
                Cancel
              </button>
            )}
          </form>

          {/* User Table */}
          <table className="w-full border-collapse border">
            <thead>
              <tr className="bg-gray-200">
                <th className="border p-2">Name</th>
                <th className="border p-2">Date of Birth</th>
                <th className="border p-2">Occupation</th>
                <th className="border p-2">Gender</th>
                <th className="border p-2">Date Added</th>
                <th className="border p-2">Actions</th>
              </tr>
            </thead>
            <tbody>
              {users.map(user => (
                <tr key={user.id}>
                  <td className="border p-2">{user.name}</td>
                  <td className="border p-2">{user.dob}</td>
                  <td className="border p-2">{user.occupation}</td>
                  <td className="border p-2">{user.gender}</td>
                  <td className="border p-2">{user.date_added}</td>
                  <td className="border p-2">
                    <button
                      onClick={() => handleEdit(user)}
                      className="bg-yellow-500 text-white p-1 rounded mr-2 hover:bg-yellow-600"
                    >
                      Edit
                    </button>
                    <button
                      onClick={() => handleDelete(user.id)}
                      className="bg-red-500 text-white p-1 rounded hover:bg-red-600"
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>